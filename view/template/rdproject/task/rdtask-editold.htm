<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />

<link rel="stylesheet" type="text/css" href="css/yxstyle.css" />
<link rel="stylesheet" type="text/css" href="js/thickbox.css" />
<link rel="stylesheet" type="text/css"
	href="js/jquery/style/Validator.css" />

<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/thickbox.js"></script>
<script type="text/javascript" src="js/common/email.js"></script>


<script type="text/javascript" src="js/jquery/formValidator.js"
	charset="UTF-8"></script>
<script type="text/javascript" src="js/jquery/formValidatorRegex.js"
	charset="UTF-8"></script>

<script type="text/javascript" src="js/DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="js/common/businesspage.js"></script>
<script type="text/javascript"
	src="view/template/rdproject/task/js/rdtk_onekey_tab.js"></script>
<script type="text/javascript"
	src="view/template/rdproject/task/js/rdtask-onekey-add-formValidator.js"></script>
<script type="text/javascript" src="view/template/rdproject/task/js/workdate.js"></script>

<script type="text/javascript" src="js/ext/ext-base.js"></script>
<script type="text/javascript" src="js/ext/ext-all.js"></script>
<script type="text/javascript" src="js/ext/common-ext.js"></script>
<link rel="stylesheet" type="text/css"
	href="js/ext/resources/css/ext-all.css" />
<link rel="stylesheet" type="text/css" href="js/ext/css/styles.css" />
<script type="text/javascript" src="js/ext/ux/tree/MyTree.class.js"></script>
<script type="text/javascript"
	src="js/ext/ux/combox/ComboBoxTree.class.js"></script>
<script type="text/javascript" src="js/ext/ux/grid/MyGrid.class.js"></script>
<script type="text/javascript"
	src="js/ext/ux/combox/MyGridComboBox.class.js"></script>
<script type="text/javascript"
	src="view/template/rdproject/task/js/taskComboGrid.js"></script>
<script type="text/javascript"
	src="view/template/common/combogrid/rdTeamComboGrid.js"></script>
<script type="text/javascript"
	src="view/template/common/combogrid/rdProjectinfoComboGrid.js"></script>
<script type="text/javascript"
	src="view/template/common/combogrid/rdplaninfoComboGrid.js"></script>
<script type="text/javascript"
	src="view/template/rdproject/task/js/rdtk_onekey_projectinfo-edit.js"></script>


<script>
	function changePlanDuration(sDayEl, eDayEl, el, e2) {//自动计算计划工期
		var subday = calculateWorkDays(document.getElementById(sDayEl).value,
				document.getElementById(eDayEl).value);
		$("#" + el).val(subday);
		$("#" + e2).val(subday * 7);
	}

//提交审批
function audit(){
	document.getElementById('form1').action="?model=rdproject_task_rdtask&action=editTask&publish=yes";
}
//保存
function save(){
	document.getElementById('form1').action="?model=rdproject_task_rdtask&action=editTask";
}
</script>
<script>
	function mailTo(){
		var userName = $('#userName').val();
		var chargeName = $('#chargeName').val() + ",";
		var mailName = userName.replace( chargeName,'');
		var actUserId = $('#actUserId').val();
		var chargeId = $('#chargeId').val() + ",";
		var mailId = actUserId.replace( chargeId,'');
		if( $('#chargeName').val() != 0){
			$('#TO_NAME').val( mailName + chargeName );
			$('#TO_ID').val( mailId + chargeId );
		}else{
			$('#TO_NAME').val( userName );
			$('#TO_ID').val( actUserId );
		}
	}
</script>
<!-- 附件上传开始 -->
<script type="text/javascript" src="swfupload/swfupload.js"></script>
<script type="text/javascript" src="swfupload/swfupload.queue.js"></script>
<script type="text/javascript" src="swfupload/fileprogress.js"></script>
<script type="text/javascript" src="swfupload/handlers.js"></script>
<link rel="stylesheet" type="text/css" href="swfupload/upload.css">
<script>
	var uploadfile;
	$(function() {
		uploadfile = createSWFUpload({
			"serviceType" : "oa_rd_task",//业务模块编码，一般取表名
			"serviceId":"{id}"
		});
	});
</script>
</head>
<body onload="mailTo()">
<form action="?model=rdproject_task_rdtask&action=editTask"
	method="POST" name="form1" id="form1">
<table class="form_main_table">
	<tr>
		<td class="main_tr_header" colspan="4">基本信息</td>
	</tr>

	<tr>
		<td class="form_text_left">任务名称</td>
		<td class="form_text_right"><input id="id" type="hidden"
			name="rdtask[id]" value={id}> <input type="hidden"
			name="rdtask['status']" value="{status}"> <input class="txt"
			type="text" id="name" value="{name}" name="rdtask[name]"><span class='red'>[*]</span><br />
		<div id="nameTip" class="dbcolumnTipTxt"></div>
	</td>
		<td class="form_text_left">责任人</td>
		<td class="form_view_right"><input type="hidden" id="chargeId"
			name="rdtask[chargeId]" value="{chargeId}"> <input type="text" class="txt"
			id="chargeName" name="rdtask[chargeName]" size="40"
			value="{chargeName}" readonly> <input type="button"
			value="选 择" class="txt_btn_a"
			onclick="loadOrgWindow('chargeId','chargeName')" onblur="mailTo();"> <input
			type="button" value="清 空" class="txt_btn_a"
			onclick="clearOrgInfo('chargeId','chargeName')"> <span class='red'>[*]</span>
		<br />
		<div id="chargeNameTip" class="dbcolumnTipTxt"></div>
		</td>
	</tr>

	<tr>
		<td class="form_text_left">所属项目</td>
		<td class="form_view_right" colspan="3"><input type="text"
			name="rdtask[projectName]" id="projectName" style="width:550"
			value="{projectName}"> <input type="hidden" id="projectId"
			name="rdtask[projectId]" value="{projectId}"> <span class='red'>[*]</span></td>
		<!--
		<td class="form_text_left">所属计划</td>
		<td class="form_view_right"><input type="text"
			name="rdtask[plantName]" id="planName" value="{planName}"> <input
			type="hidden" id="planId" name="rdtask[planId]">
			<span class='red'>[*]</span>
		</td>
		 -->
	</tr>
	<tr id="belongPlan">
		<td class="form_text_left">所属计划</td>
		<td class="form_view_right" colspan="3"><input type="text"
			style="width: 550" name="rdtask[planName]" id="planName" value="{planName}">
		<input type="hidden" id="planId" name="rdtask[planId]" value="{planId}">
		</td>
	</tr>

	<tr>
		<td class="form_text_left">任务类型</td>
		<td class="form_text_right"><select class="select"
			name="rdtask[taskType]" >
			{taskType}
		</select><span class='red'>[*]</span></td>
		<td class="form_text_left">优先级</td>
		<td class="form_text_right"><select class="select"
			name="rdtask[priority]">
			{priority}
		</select><span class='red'>[*]</span></td>
	</tr>
	<tr>
		<td class="form_text_left">计划开始日期</td>
		<td class="form_text_right"><input class="txt" type="text"
			onblur="changePlanDuration('planBeginDate','planEndDate','planDuration')"
			name="rdtask[planBeginDate]" onfocus="WdatePicker()"
			id="planBeginDate" value="{planBeginDate}"><br />
		<div id="planBeginDateTip" class="dbcolumnTipTxt">
		</td>
		<td class="form_text_left">计划完成日期</td>
		<td class="form_text_right"><input class="txt" type="text"
			onblur="changePlanDuration('planBeginDate','planEndDate','planDuration')"
			name="rdtask[planEndDate]" onfocus="WdatePicker()" id="planEndDate"
			value="{planEndDate}"><br />
		<div id="planEndDateTip" class="dbcolumnTipTxt">
		</td>
	</tr>

	<tr>
		<td class="form_text_left">估计工作量</td>
		<td class="form_text_right"><input class="txt" type="text"
			name="rdtask[appraiseWorkload]" id="appraiseWorkload" value="{appraiseWorkload}"><span class='red'>[*]</span>
			<br/><div id="appraiseWorkloadTip" class="dbcolumnTipTxt"></div></td>
		<td class="form_text_left">计划工期 (天)</td>
		<td class="form_text_right"><input class="txt" type="text"
			readOnly name="rdtask[planDuration]" value="{planDuration}"
			id="planDuration"></td>
	</tr>

	<tr>

		<td class="form_text_left">审核人</td>
		<td class="form_view_right" colspan="3"><input type="hidden"
			id="auditId" name="rdtask[tkaudituser][auditId]"
			value="{auditUserIds}"> <input type="text" class="txt"
			size="40" style="width:550" name="rdtask[tkaudituser][auditUser]"
			id="auditName" value="{auditUserNames}" readonly> <input
			type="button" value="选 择" class="txt_btn_a"
			onclick="loadOrgWindow('auditId','auditName')"> <input
			type="button" value="清 空" class="txt_btn_a"
			onclick="clearOrgInfo('auditId','auditName')"></td>
	</tr>
	<tr>
		<td class="form_text_left">参与人(项目内成员)</td>
		<td class="form_view_right" colspan="3">
			<input type="hidden" id="withinActId" value="{withinId}">
			<input type="text" class="txt" size="40" style="width: 550" id="withinActName" value="{withinName}" onblur="actUserFun();mailTo();">

			<input type="hidden" id="actUserId" name="rdtask[tkactuser][actUserId]" value="{actUserIds}">
			<input type="hidden" class="txt" size="40" style="width: 550"
				name="rdtask[tkactuser][userName]" id="userName" readonly value="{actUserNames}">
		</td>
	</tr>
	<tr>
		<td class="form_text_left">参与人(项目外成员)</td>
		<td class="form_view_right" colspan="3">
			<input type="hidden" id="withoutActId" value="{withoutId}">
			<input type="text" class="txt" size="40" style="width: 550"
				id="withoutActName" value="{withoutName}" readonly>
			<input type="button" value="选 择" class="txt_btn_a"
				onclick="loadOrgWindow2('withoutActId','withoutActName')" onblur="actUserFun();">
			<input type="button" value="清 空" class="txt_btn_a"
				onclick="clearOrgInfo('withoutActId','withoutActName')" onblur="mailTo();">
		</td>
	</tr>
	<tr>
		<td class="form_text_left">任务描述</td>
		<td class="form_text_right" colspan="3"><textarea
			style="width:700" name="rdtask[remark]" class="txt_txtarea_font">{remark}</textarea></td>
	</tr>
	<tr>
		<td class="form_text_left">验收标准</td>
		<td class="form_text_right" colspan="3"><textarea
			style="width:700" name="rdtask[inspectInfo]" class="txt_txtarea_font">{inspectInfo}</textarea></td>
	</tr>
	<tr>
		<td class="form_text_left">附件</td>
		<td class="form_text_right" colspan="3">
		<div class="upload">
		<div class="upload" id="fsUploadProgress"></div>
		<div class="upload"><span id="swfupload"></span> <input
			id="btnCancel" type="button" value="中止上传"
			onclick="cancelQueue(uploadfile);" disabled="disabled" /> <br />
		</div>
		<div id="uploadfileList" class="upload">{file}</div>
		</div>
<input class="txt" type="text" id="uploadfiletype" /> <input
			type="hidden" id="uploadfiletypeId" />

		</td>
	</tr>
	<tr>
   		<td class="form_text_left">是否发送邮件
       	</td>
   		<td colspan="3" class="form_text_right">
   			<input type="radio" name="rdtask[email][issend]" value="y" checked="checked" onclick="checkEmailTA(this)"/>是
      		<input type="radio" name="rdtask[email][issend]" value="n" onclick="checkEmailTA(this);" />否
		</td>
	</tr>
   	<tr id="maildiv">
   		<td class="form_text_left">邮件发送至
       	</td>
       	<td colspan="3" class="form_text_right">
    		<input type="hidden" name="rdtask[email][TO_ID]" id="TO_ID" readonly="readonly"/>
		    <input type="text" class="txtlong" name="rdtask[email][TO_NAME]" id="TO_NAME" readonly="readonly"/>
		    <input type="button" class="txt_btn_a" value="选 择" onclick="loadOrgWindow2('TO_ID','TO_NAME')" title="选择"/>
		    <input type="button" class="txt_btn_a" value="清 空" onclick="clearOrgInfo('TO_ID','TO_NAME')" title="清空"/>
	    </td>
   	</tr>
	<tr>
		<td colspan="4">
		<input type="hidden" id="id" name="task[id]"
			value="{id}" /> <input name="" type="submit" class="txt_btn_a"
			value="保存 "  onclick="save();"> <input name="" type="button" class="txt_btn_a"
			onclick="self.parent.tb_remove();" value="返回 "></td>
	</tr>
</table>
</form>
</body>
</html>