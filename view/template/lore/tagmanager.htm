<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Language" content="zh_cn" />
<meta http-equiv="Content-Type" content="text/html; charset=GB2312" />
<link rel="stylesheet" href="js/thickbox.css" type="text/css" media="screen" />
<link rel="stylesheet" type="text/css" media="screen" href="images/style.css" />
<link rel="stylesheet" type="text/css" href="module/ajax_search/sea.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="js/jqgrid/css/ui.jqgrid.css" />
<link rel="stylesheet" type="text/css" media="screen" href="js/jqgrid/css/jquery-ui-1.8.2.custom.css" />
<link rel="stylesheet" href="js/jquery-autocomplete/jquery.autocomplete.css" type="text/css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jquery-autocomplete/jquery.autocomplete.min.js"></script>
<script src="js/jqgrid/i18n/grid.locale-cn.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jqgrid/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="module/ajax_search/sea.js"></script>
<script type="text/javascript" src="js/thickbox.js"></script>

<title></title>
</head>
<style>
.ui-jqgrid-sortable {
	font-weight:normal;
	font-size:12px;
	height:24px;
}
.ui-jqgrid-title {
	clear:both;
	font-size:12px;
	height:24px;
	line-height:20px;
}
.ui-helper-clearfix {
	height:24px;
}
.ui-row-ltr td {
	border-top:0px #DDDDDD solid;
	border-left:0px #DDDDDD solid;
	border-right:0px #DDDDDD solid;
}
.ui-widget-content jqgrow ui-row-ltr{
 	border-left:0px #DDDDDD solid;
}
.ui-jqgrid tr.ui-row-ltr td {
  border-right-color: inherit;
  border-right-style:none;
  border-right-width: 1px;
}
.ui-state-default ui-th-column ui-th-ltr{
	border-right-style:hidden;
	border-left:0px #DDDDDD solid;
	}
	
.ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default{
	border-right-style:hidden;
	border-right:0px #DDDDDD solid;
	}
.ui-jqgrid .ui-jqgrid-htable th div{
	 height: 24px;
    line-height: 24px;
	
	}
table td{
	 height: 22px;
    line-height: 15px;
	
	}
.ui-jqgrid tr.jqgrow td
{
	border-bottom-color: #C2D5E3;
	border-bottom-style:dashed;
	border-bottom-width: 1px;
	border-right-color: #C2D5E3;
	border-right-style:dashed;
	border-right-width: 1px;
	font-weight: normal;
	height: 26px;
	overflow: hidden;
	padding: 0 2px;
	white-space: pre;
}
.ui-widget-content a {
  color: #362B36;
 
}
.ui-widget-content a:link { text-decoration: none;}

.ui-widget-content a:active { text-decoration:underline}

.ui-widget-content a:hover { text-decoration:underline;color: red}

.ui-widget-content a:visited { text-decoration: none;color: green} 

.fwinmask { font-size:12px; }
.fwinmask .t_l, .t_c, .t_r, .m_l, .m_r, .b_l, .b_c, .b_r
{
	height:5px;
	width:5px;
	overflow:hidden;
	background:#000;
	opacity:0.2;
	filter:alpha(opacity=20);
}
.t_c, .b_c { height:8px; }
.m_l, .m_r { width:8px; }
body, input, button, select, textarea {
  color: #444444;
  font: 12px/1.5 Tahoma,Helvetica,mingliu,sans-serif,Hei;
}
.flb {
  height: 20px;
  line-height: 20px;
  padding: 10px 10px 8px;
}
.flbc {
  background: url("images/lore/cls.gif") no-repeat scroll 0 0 transparent;
  float: left;
  height: 20px;
  overflow: hidden;
  text-indent: -9999px;
  width: 20px;
}
.flbc:hover {
  background-position: 0 -20px;
}
.fwinmask{
	background:url(images/lore/background.png) repeat-x; 
}
h1, h2, h3, h4, h5, h6 {
    font-size: 1em;
}
#k_favorite {
  background-image: url("images/lore/fav.gif");
}
#favorite a {
  background-color: #E5EDF2;
  background-position: 5px 50%;
  background-repeat: no-repeat;
  border: 1px solid #C2D5E3;
  margin: 0 2px;
  padding: 5px 8px 5px 25px;
}

 .quote, .pl .blockcode {
    margin: 0px 0;
    padding: 0px 10px 0px 65px;
}
 .quote {
    background: url("images/lore/icon_quote_s.gif") no-repeat scroll 20px 6px #F9F9F9;
    padding-bottom: 5px;
}
 .quote blockquote {
    background: url("images/lore/icon_quote_e.gif") no-repeat scroll 100% 100% transparent;
    line-height: 1.6;
    margin: 0;
    padding: 0 65px 5px 0;
}
 .blockcode {
    background: url("images/lore/codebg.gif") repeat-y scroll 0 0 #F7F7F7;
    border: 1px solid #CCCCCC;
    overflow: hidden;
    padding: 0px 0 5px 10px;
}
.pipe{margin:0 5px;color:#CCC;}
.locked {
  background: url("images/lore/locked.gif") no-repeat scroll 6px 50% #FFFFFF;
  border: 1px dashed #FF9A9A;
  font-size: 12px;
  margin: 10px 0;
  padding: 8px 8px 8px 24px;
}

</style>
<body>

<div id="sug" style="position: absolute;  z-index:999999999999;"></div>
<div id="listd" style='float:left; width:98%; margin:10px;'>
  <table  id="list" class="scroll"  border="0" width="100%" cellpadding="0" cellspacing="0" >
  </table>
  <div id="plist"></div>
 </div>
<script type="text/javascript">

var rand=Math.random()*100000;
var height = $(window).height()>650?$(window).height():650;
jQuery(document).ready(function(){ 
function my_input(value, options) {
		return $("<span id='f'></span><input type='text' id='username' onclick='getuserid(this)'  value='"+
		value+"'  type='text' />");
		//$("<span id='usernamelist'></span><input type='text' id='username' size='200'onclick='setdiv(this)' onfocus='setdiv(this)' onblur=losefouse() onkeydown='keydown(this)' value='"+
		//value+"' onpropertychange=\"change(this,'user','USER_NAME','module/ajax_search/')\" type='text' />");
}
function my_value(value) {
	return  value.val();
}

function my_dtinput(value, options) {
		return $("<input type='text' size='200'onclick='setdiv(this)' onfocus='setdiv(this)' onblur=losefouse() onkeydown='keydown(this)' value='"+
		value+"' onpropertychange=\"change(this,'user','USER_NAME','module/ajax_search/')\" type='text' />");
}
function my_dtvalue(value) {
	return  value.val();
}
jQuery("#list").jqGrid({
   	url:'?model=lore_type&action=tagmanagerdata',
	datatype: "json",
	  // treeGridModel: 'adjacency',
                    colNames: ["id", "板块名", "等级名", "标签名","管理员","部门",'排序','风格','tid','lid','操作','max','min'],
                    colModel: [{name:"id",index:'id',width:100,hidden: true},
							   {name:"name",index:'name',width:100,editable:true,align:'center',editable:true},
							   {name:"levelname",index:'levelname',width:100,editable:true,align:'center',editable:true},
							   {name:"tagname",index:'tagname',width:100,editable:true,align:'center',editable:true},
							   {name:"admin",index:'admin',width: 100,hidden: false,align:'center'},
							   {name:"admins",index:'admins',width: 100,hidden: false,align:'center'},
							   {name:"sortid",index:'sortid',width: 50,hidden: false,align:'center',editable:true},
								{name:"styleid",index:'styleid',width: 100,hidden: true,align:'center',editable:true},
								{name:"tid",index:'tid',width: 100,hidden: true,align:'center',editable:false },
								{name:"lid",index:'lid',width: 100,hidden: true,align:'center',editable:false },
								{name:"edits",index:'edits',width: 100,hidden: false,align:'center',editable:false},
								{name:"maxs",index:'maxs',width: 100,hidden: true,align:'center',editable:false},
								{name:"mins",index:'mins',width: 100,hidden: true,align:'center',editable:false}
							  ],
					sortorder:"asc",
					sortname:'tname',
                    autowidth:false,
					loadui: 'disable',
					rowNum:20,
					rowList:[20,30],
					height: height-98,
					align:'center',
					pager: '#plist',
					autowidth: true, 
					viewrecords: true, 
					caption:"<span id='headname' style='height:24px;'><strong style='color:#2779AA'>标签管理中心</strong>"
						 +"&nbsp;<input type='button' id='newbotton' name='newbotton'  value='新增' align='middle' /></span>",
					//editurl: "?model=lore_type&action=edittype",
					afterInsertRow:function (rowid, rowData){
						var str='';
						 if(rowData.flag==1){
						 str +='<a style="color:#0000ff;" href="javascript:add(\''+rowid+'\',\''+rowData.id+'\',\''+rowData.name+'\');">新增</a> ';
						 }else{
						 str +='<a style="color:#0000ff;" href="javascript:modify(\''+rowid+'\',\''+rowData.id+'\',\''+rowData.tid+'\',\''+rowData.lid+'\',\''+rowData.name+'\');">修改</a> | '+
								'<a style="color:#0000ff;" href="javascript:dels(\''+rowid+'\',\''+rowData.id+'\',\''+rowData.name+'\');">删除</a>';
						 }
					   var sortimg='';
					   if(rowData.sortid==rowData.maxs){
						  var sortimg='<img src="images/lore/uparrow1.png" style="cursor:pointer" onclick="sorts(\''+rowid+'\',\'up\')"  width="10" height="10" />';
						}else if(rowData.sortid==rowData.mins){
						  var sortimg='<img src="images/lore/downarrow1.png" style="cursor:pointer" onclick="sorts(\''+rowid+'\',\'down\')" width="10" height="10"/>';
						}else{
						 var sortimg='<img src="images/lore/uparrow1.png" style="cursor:pointer" onclick="sorts(\''+rowid+'\',\'up\')" width="10" height="10"/>'
							+'&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/lore/downarrow1.png" style="cursor:pointer" onclick="sorts(\''+rowid+'\',\'down\')" width="10" height="10" />';
						}
						jQuery("#list").jqGrid('setRowData',rowid,{edits:str});
						jQuery("#list").jqGrid('setRowData',rowid,{sortid:sortimg});
						
					}
})

	jQuery("#list").jqGrid('navGrid','#plist',{add:false,edit:false,del:false,search:false});

	$("#subm").bind("click", function(e){
					submits();
          });
	
	$("#meetingtype").bind("change", function(e){
		 submits();
     });
	
		$("#newbotton").bind("click", function(e){
					tb_show('修改信息', '?model=lore_type&action=newtag&placeValuesBefore&TB_iframe=true&modal=false&height=400&width=600');
          });
	 
}); 
function modify(key,id,tid,lid,name){
	   tb_show('修改'+name+'信息', '?model=lore_type&action=modifytag&id='+id+'&tid='+tid+'&lid='+lid+'&rand_key='
			   +key+'&placeValuesBefore&TB_iframe=true&modal=false&height=300&width=500');
	 }
function add(id,key,name){
	   tb_show('增加'+name+'等级信息', '?model=lore_type&action=newtag&id='+id+'&placeValuesBefore&TB_iframe=true&modal=false&height=300&width=500');
	 }	
	 
function dels(key,id,name){
 if(confirm('您要删除-'+name+'-标签吗？')){
	 $.post('?model=lore_type&action=deltype',{key:key,pid:id,rand:rand},
				function(data)
				{
					if (data==1)
					{
						alert('删除成功！');
							$("#refresh_list").click();
					}else{
						
					alert('删除失败 ！')	;
						}
				}
				);
			} 
}
function sorts(key,methods){
	$.post('?model=lore_type&action=tagsorts',{key:key,methods:methods,rand:rand},
		  function(data)
		  {
			  if (data)
			  {
				  $("#refresh_list").click();
			  }
		  }
		  );
}
</script>
</body>
</html>