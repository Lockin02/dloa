<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=GB2312" />
<script type="text/javascript" src="js/extui/boot.js"></script>
<title></title>
</head>
<style type="text/css">
body {
	margin: 0px;
	padding: 0px;
	border: 0px;
	width: 100%;
	height: 100%;
	overflow: hidden;
}
/*
     input[type=text] { background-color:#e1e1e1; }
	 .table td {border-collapse:collapse; border: 1px solid #000000;}
	  .table table {border-collapse:collapse;border: 1px solid #000000;font-size:12px;}
	 textarea {background-color:#e1e1e1;}
	 */
.table {
	width: 99.4%;
	border: 2px solid #000;/*#D3E5FA;
	/*border:1px solid #DDDDDD;*/
	border-collapse: collapse;
}
.table td {
	padding: 3px;
	font-size: 12px;
	line-height: 16px;
	white-space: normal;
	border: 1px solid #000;
	font-weight: normal;
	text-align: center;
	vertical-align: middle;
	/*border-collapse: collapse;
	
	border-top-style:none;
	border-left-style:none;*/
	font-family: "宋体", "微软雅黑", Verdana;
}
.table td div {
	text-align: center;
	vertical-align: middle;
}
</style>
<body>
<div class="mini-fit"  style="margin:10px;">
<form id="form" action="?model=administration_appraisal_performance_list&action=perExInSubmit"method="post"  enctype="multipart/form-data">
  <table border="0"  cellspacing="0" cellpadding="0" width="100%">
    <tr>
      <td align="center" ><table width="100%" border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td colspan="8" height="40" align="center"><span style="font-size: 22px"><strong>{tplName}</strong></span></td>
          </tr>
          <tr>
            <td align="left"><strong>姓名：</strong></td>
            <td align="left">{userName}</td>
            <td align="left"><strong>部门：</strong></td>
            <td align="left">{userDeptName}</td>
            <td align="left"><strong>职位：</strong></td>
            <td>{userJobName}</td>
            <td align="right"><strong>考核周期：</strong></td>
            <td align="left">{tplWeek}</td>
          </tr>
        </table></td>
    </tr>
    <tr>
      <td><table width="100%"  class="table" border="0" cellspacing="0" cellpadding="0">
          {strList} 
          <!--
          <tr style="border-top:2px solid #000000;">
            <td colspan="3" rowspan="2" nowrap="nowrap" style="text-align:right; vertical-align:middle;"><strong>合计：</strong></td>
            <td nowrap="nowrap"  rowspan="2" style="border-right:2px solid #000000;"><strong>{kpiRight}%</strong></td>
            <td colspan="5" nowrap="nowrap" style="text-align:right; vertical-align:middle;"><strong>得分合计：</strong></td>
            <td nowrap="nowrap" style="border-left:2px solid #000000;"> 0 </td>
            <td nowrap="nowrap" >&nbsp;</td>
            <td nowrap="nowrap" > 7.73 </td>
            <td nowrap="nowrap" >&nbsp;</td>
            <td nowrap="nowrap"> 8.227 </td>
            <td nowrap="nowrap"> 8.227 </td>
          </tr>
          <tr style="border-bottom:2px solid #000000;">
            <td colspan="5" nowrap="nowrap" style="border-right:2px solid #000000;text-align:right;vertical-align:middle;"><strong>考核总分：</strong></td>
            <td colspan="11" nowrap="nowrap" ><strong>82.27</span></td>
          </tr>
          
          <tr>
            <td colspan="4" nowrap="nowrap" style="border-right:2px solid #000000;text-align:right;"><strong>考核人意见：</strong></td>
            <td colspan="8" style="width: 100%;"> 近期封闭时间较长，也都很辛苦，好的就不多说了，只说几个建议。
              需要加强对成员代码质量的控制，以及对算法与架构修改的审查，开发人员的代码自测。
              对于项目组内的所有开发人员的工作，虽然由于一些历史原因存在一些差别，但因此更需要更主动地去了解与把控。</td>
            <td nowrap="nowrap" colspan="2"><p align="center"> <strong>签名人：</strong></p></td>
            <td colspan="2" nowrap="nowrap"><p align="center"> <strong>张磊（研发部）　</strong></p></td>
          </tr>
          <tr>
            <td colspan="4" nowrap="nowrap" style="border-right:2px solid #000000; text-align:right"><strong>被考核人意见：</strong></td>
            <td colspan="8" style="width:100%"><textarea class="my_opinion" id="text_0.8476825095566819" name="my_opinion" style="overflow: auto"></textarea></td>
            <td nowrap="nowrap" colspan="2"><p align="center"> <strong>签名人：</strong></p></td>
            <td colspan="2" nowrap="nowrap" style="height: 37px"><p align="center"> <strong>王德驰　</strong></p></td>
          </tr>
          <tr>
            <td colspan="4" nowrap="nowrap" style="border-right:2px solid #000000;text-align:right;"><strong>审核人意见：</strong></td>
            <td colspan="8" style="width: 100%;"></td>
            <td nowrap="nowrap" colspan="2"><p align="center"> <strong>签名人：</strong></p></td>
            <td colspan="2" nowrap="nowrap" ><p align="center"> <strong>陆金红　</strong></p></td>
          </tr>
          <tr>
            <td colspan="20"><div  style="text-align:center;margin:0px; border-bottom:0px;  border-left:0px; border-right:0px;" >
             <a class="mini-button" style="width:60px;" onclick="submitForm()">提交</a> <span style="display:inline-block;width:25px;"></span>
             <a class="mini-button" style="width:60px;" onclick="onCancel()">关闭</a></div></td>
          </tr>-->
        </table></td>
    </tr>
  </table>
 </form>
</div>
<script type="text/javascript"> 
mini.parse();
try{
inFlag={inFlag};
if(inFlag==4){
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asAssFra').val(val);
	$('#assConts').html(val);
	getCount();
}else if(inFlag==5){
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asAuditFra').val(val);
	$('#auditConts').html(val);
	getCount();
}
}catch(e){
	
}
function submitForm(flag) {
	var forms = new mini.Form("#form");
	forms.validate();
	if(forms.isValid() == false) return false;
	if(flag){
	 $('#isConfim').val(flag);
	}
	var inputs = $('.perAss input[type=hidden]').get();
	if (inputs.length > 1) {
		 val=getValue(); 
		 if(val==''||val==0){
			alert('请进行评分!');
			return  false;
		 }
	}
	$('#form').submit();
}
function setEvals(e){
	if(e.value>10){
		alert("此分数不能大于10分！"); 
		v=mini.get(e.sender.id);
		v.setValue(10);	
   }	
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asPersFra').val(val);
	$('#perAssConts').html(val);
	getCount();
}
function setAsEvals(e){
	if(e.value>10){
		alert("此分数不能大于10分！"); 
		v=mini.get(e.sender.id);
		v.setValue(10);	
   }
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asAssFra').val(val);
	$('#assConts').html(val);
	getCount();
}

function setAuditEvals(e){
	if(e.value>10){
		alert("此分数不能大于10分！"); 
		v=mini.get(e.sender.id);
		v.setValue(10);	
   }
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asAuditFra').val(val);
	$('#auditConts').html(val);
	getCount();
}

function setPevals(e){
	if(e.value>10){
		alert("此分数不能大于10分！"); 
		v=mini.get(e.sender.id);
		v.setValue(10);	
   }
	var val=getValue();
	if(val==0){
	 val='';
	}
	$('#asPevFra').val(val);
    $('#pAssConts').html(val);
	
}

function getValue(){
	var inputs = $('.perAss input[type=hidden]').get();
	var values=0;
	if (inputs.length > 1) {
		for ( var i = 0; i < inputs.length; i++) {
			var isAss = Number(mini.get('kpiRight'+inputs[i].id.replace('$value','')).getValue());
			values += toDecimal(Number(inputs[i].value)*isAss)
		
		}
		values=toDecimal(values/10)
	}
	return 	values;
}

getCount();
function getCount(){
	var a=Number($('#asAuditFra').val());
	var b=Number($('#asAssFra').val());
	var c=Number($('#asPersFra').val());
	
	var d=Number($('#asPers').val());
	var e=Number($('#asAudit').val());
	var f=Number($('#asAss').val());
	var perUserId=$('#perUserId').val();
	var seUserId=$('#seUserId').val();
	var inFlag=Number($('#inFlag').val());
	count=toDecimal((Number(a*e)+Number(b*f)+Number(c*d))/100);
	if(count==0){
	 count='';
	}
	$('#countFraction').val(count);
	if(inFlag>2&&inFlag<6.5&&perUserId==seUserId){
		$('#contAll').html('');
	}else{
		$('#contAll').html(count);
	}
	
}

function CloseWindow(action) {
   if (window.CloseOwnerWindow) return window.CloseOwnerWindow(action);
	else window.close();          
}
function onCancel(e) {
	CloseWindow("cancel");
}
 function toDecimal(x) {  
            var f = parseFloat(x);  
            if (isNaN(f)) {  
                return;  
            }  
            f = Math.round(x*100)/100;  
            return f;  
        }  

function upFile(cId,index,target)
{
	index++;
	var flag=1;
	box=$('#upFile'+cId+' input').get();
	var isIE = /msie/i.test(navigator.userAgent) && !window.opera; 
	if(box.length>0){
	  for(i=0;i<box.length;i++){
			  if(box[i].value==''){
				 flag=2;  
			  }
		  }
	}
	
	 if(target.value!=''){
	      try{
			  var filePath=target.value
			  var Errors='';
			  var extStart=filePath.lastIndexOf(".");
			  var ext=filePath.substring(extStart,filePath.length).toUpperCase();
			  if(ext=='.PHP'||ext=='.JSP'||ext=='.ASP'||ext=='.ASPX'||ext=='.JS'||ext=='.EXE'||ext=='.HTM'||ext=='.HTML'||ext=='.SQL'){
				  Errors=1;
				  alert( '附件为不安全文件类型！');
			  }
			  var fileSize = 0;          
				if (isIE && !target.files) {      
				  var fileSystem = new ActiveXObject("Scripting.FileSystemObject");         
				  var file = fileSystem.GetFile (filePath);      
				  fileSize = file.Size;  
				} else {     
				 	fileSize = target.files[0].size;      
				}
			if(fileSize>7*1024*1024){
				Errors=1;
				alert('附件大小不超过7M！');
			}	
     }catch (e){ 
         
      }
	}
	if(Errors==1){
		delUpFile(cId,index-1);
	}
	if(flag==1){
	  $('#upFile'+cId).append('<div id="upFile_'+cId+'_'+index+'" style="width:100%;">'
								+'<input type="file" size="1" onchange="upFile('+cId+','+index+',this);" name="upFile['+cId+'][]"/>'
								+'<img onclick="delUpFile('+cId+','+index+')" src="js/extui/themes/dloa/images/bgs/delete.png"'
								+' style="border:0px;cursor:pointer;"></div>');
	}
}
function delUpFile(cId,index)
{
    if($('#upFile_'+cId+'_'+index+' input').val()!=''){
	   $('#upFile_'+cId+'_'+index).remove();
	}
}
function delAtt(aId){
	if(aId){
		if (confirm('您确定要删除当前附件吗？')) 
		{								
			$.post('?model=administration_appraisal_performance_list&action=delAtt',{key:aId},
				function (data)
				{
					if(data)
					{
						$("#attDel"+aId).remove();
						 alert("删除成功！");
					}else{
					     alert("删除失败！");
					}
				 }
				);
			}
	}
}
function returnBack(kId,inFlag){
	if(kId&&inFlag){
		if (confirm('您确定要打回吗？')) 
		{								
			$.post('?model=administration_appraisal_performance_list&action=updateInFlag',{kId:kId,inFlag:inFlag},
				function (data)
				{
					
					if(data=='1')
					{
						  onCancel();
						 alert("打回成功！");
					}else{
					     alert("打回失败！");
					}
				 }
				);
			}
	}
}

</script>
</body>
</html>